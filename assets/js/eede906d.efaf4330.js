"use strict";(self.webpackChunkdannyjiajia_github_io=self.webpackChunkdannyjiajia_github_io||[]).push([[7613],{4299:e=>{e.exports=JSON.parse('{"permalink":"/2016/think-about-android-gradle","source":"@site/blog/2016/think-about-android-gradle.md","title":"\u5bf9Android\u7684Gradle\u63d2\u4ef6\u7684\u7406\u89e3","description":"\u672c\u6765\u6253\u7b97\u5199\u4e00\u7bc7\u5173\u4e8eAndroid\u7684gradle\u63d2\u4ef6\u7684\u4f7f\u7528\u8be6\u89e3\u4e4b\u7c7b\u7684\u6587\u7ae0,\u7ed3\u679c\u5728\u77e5\u4e4e\u770b\u5230\u4e86\u4e00\u7bc7\u4e0d\u9519\u7684\u3002\u6211\u5728\u8fd9\u91cc\u603b\u7ed3\u4e0b\u5427\u3002","date":"2016-03-28T19:26:48.000Z","tags":[{"inline":true,"label":"Android","permalink":"/tags/android"},{"inline":true,"label":"Android Studio","permalink":"/tags/android-studio"},{"inline":true,"label":"Gradle","permalink":"/tags/gradle"},{"inline":true,"label":"Ant","permalink":"/tags/ant"},{"inline":true,"label":"Antenna","permalink":"/tags/antenna"}],"readingTime":3.37,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5bf9Android\u7684Gradle\u63d2\u4ef6\u7684\u7406\u89e3","date":"2016-03-28T19:26:48.000Z","tags":["Android","Android Studio","Gradle","Ant","Antenna"],"categories":null},"unlisted":false,"prevItem":{"title":"rsync\u5728Windows\u4e0a\u7684\u6743\u9650\u95ee\u9898","permalink":"/2016/about-rsync"},"nextItem":{"title":"\u8c08\u8c08next\u4e3b\u9898\u5982\u4f55\u6dfb\u52a0\\"Fork me on Github\\"","permalink":"/2016/github-link-with-next"}}')},8418:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>p,frontMatter:()=>d,metadata:()=>a,toc:()=>o});var a=r(4299),s=r(4848),i=r(8453);const d={title:"\u5bf9Android\u7684Gradle\u63d2\u4ef6\u7684\u7406\u89e3",date:new Date("2016-03-28T19:26:48.000Z"),tags:["Android","Android Studio","Gradle","Ant","Antenna"],categories:null},l=void 0,t={authorsImageUrls:[]},o=[{value:"\u5f00\u59cb",id:"\u5f00\u59cb",level:3},{value:"\u81ea\u5df1\u7684\u65b9\u6848",id:"\u81ea\u5df1\u7684\u65b9\u6848",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:4},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:4},{value:"\u6700\u540e",id:"\u6700\u540e",level:4}];function c(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u672c\u6765\u6253\u7b97\u5199\u4e00\u7bc7\u5173\u4e8eAndroid\u7684gradle\u63d2\u4ef6\u7684\u4f7f\u7528\u8be6\u89e3\u4e4b\u7c7b\u7684\u6587\u7ae0,\u7ed3\u679c\u5728\u77e5\u4e4e\u770b\u5230\u4e86\u4e00\u7bc7\u4e0d\u9519\u7684\u3002\u6211\u5728\u8fd9\u91cc\u603b\u7ed3\u4e0b\u5427\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"http://ghui.me/post/2015/03/create-several-variants",children:"http://ghui.me/post/2015/03/create-several-variants"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5f00\u59cb",children:"\u5f00\u59cb"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5408\u5e76\u7684\u601d\u60f3"}),"\n",(0,s.jsxs)(n.p,{children:["\u65b0\u7684\u6784\u5efa\u7cfb\u7edf\u6700\u4e3b\u8981\u7684\u60f3\u6cd5\u5c31\u662f\u5408\u5e76,\u5c06\u5404\u81ea",(0,s.jsx)(n.code,{children:"Productflavor"}),"\u5b9a\u4e49\u7684\u4e0d\u540c\u9879\u76ee\u914d\u7f6e(applicationId,versionCode,signingConfig,sourceSets...)\u4ee5\u53ca\u8d44\u6e90(java\u4ee3\u7801,AndroidManifest.xml,res,jni...)\u548c\u516c\u7528\u7684",(0,s.jsx)(n.code,{children:"defaultConfig"}),"\u5b9a\u4e49\u7684\u914d\u7f6e\u3001",(0,s.jsx)(n.code,{children:"sourceSets.main"}),"\u5b9a\u4e49\u7684\u8d44\u6e90\u8fdb\u884c\u5408\u5e76"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"applicationId\u548cAndroidManifest.xml\u4e2d\u7684package"}),"\n",(0,s.jsx)(n.p,{children:"applicationId\u7528\u6765\u5728Android\u8bbe\u5907\u548cGoogle Play\u6765\u533a\u5206apk,\u4e5f\u5c31\u662f\u4ee5\u524d\u7684package.\u800c\u73b0\u5728AndroidManifest.xml\u4e2d\u7684package\u4ec5\u7528\u6765\u751f\u6210R.java"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5404\u81ea\u7684Productflavor\u53ef\u4ee5\u663e\u5f0f\u7684\u8bbe\u7f6esourceSets"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0d\u8981\u8bef\u4ee5\u4e3a\u6bcf\u4e2aProductflavor\u5bf9\u5e94\u7684java\u4ee3\u7801\u76ee\u5f55\u548c\u8d44\u6e90\u76ee\u5f55\u662f\u5b9a\u6b7b\u7684,\u53ef\u4ee5\u901a\u8fc7sourceSets.flavor\u6765\u81ea\u5b9a\u4e49,\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u5b9a\u4e49\u624d\u662f\u5982\u4e0a\u6587\u4e2d\u6240\u8bf4\u7684\u8def\u5f84.\u5982:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'sourceSets.flavor {\n    java.srcDir "src-flavor"\n    res.srcDir "res-flavor"\n    jniLibs.srcDir "libs-flavor"\n    manifest.srcFile "AndroidManifestflavor.xml"\n    assets.srcDir "assets-flavor"\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u5404\u81ea\u7684Productflavor\u4e0b\u4e0d\u8981\u5b9a\u4e49\u548c",(0,s.jsx)(n.code,{children:"main"}),"\u4e2d\u540c\u540d\u7684java\u7c7b"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"packagingOptions\u7684\u4e0d\u8db3"}),"\n",(0,s.jsxs)(n.p,{children:["packagingOptions\u867d\u7136\u53ef\u4ee5\u53d6\u6d88\u6389\u4e00\u4e9bso\u6587\u4ef6\u7684\u5f15\u7528,\u4f46\u662f\u6682\u65f6\u8fd8\u4e0d\u80fd\u505a\u5230\u5bf9\u4e0d\u540c\u7684",(0,s.jsx)(n.code,{children:"Productflavor"}),"\u8fdb\u884c\u8bbe\u7f6e,\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e09\u65b9\u63d2\u4ef6",(0,s.jsx)(n.a,{href:"https://github.com/Jween/android-soexcluder",children:"https://github.com/Jween/android-soexcluder"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u81ea\u5df1\u7684\u65b9\u6848",children:"\u81ea\u5df1\u7684\u65b9\u6848"}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u91c7\u7528\u7684\u662f\u540c\u4e00\u4efdjava\u4ee3\u7801,\u540c\u4e00\u4e2a\u9759\u6001\u5e93,\u4e0d\u540c\u7684\u8d44\u6e90\u76ee\u5f55,\u4e0d\u540c\u7684",(0,s.jsx)(n.code,{children:"AndroidManifest.xml"}),"\u6587\u4ef6.java\u4ee3\u7801\u901a\u8fc7",(0,s.jsx)(n.code,{children:"ant"}),"\u63d2\u4ef6\u7684\u5b8f\u5b9a\u4e49\u5206\u522b\u751f\u6210\u4e0d\u540c\u7684java\u4ee3\u7801(\u53ea\u662f\u5728\u7f16\u8bd1\u65f6).\u8fd9\u6837\u5c31\u8fbe\u5230\u4e86\u7075\u6d3b\u6253\u5305\u7684\u7279\u70b9,\u6839\u636e\u4e0d\u540c\u7684\u5b8f\u5b9a\u4e49\u5b9a\u5236\u51fa\u4e0d\u540c\u7684apk,\u4ee3\u7801\u59cb\u7ec8\u7ef4\u62a4\u4e00\u4efd"]}),"\n",(0,s.jsx)(n.h4,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528ant\u7684\u63d2\u4ef6",(0,s.jsx)(n.a,{href:"http://antenna.sourceforge.net/wtkpreprocess.php",children:"antenna"}),",\u4e0b\u8f7d\u540e\u5c06jar\u5305\u653e\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u7684",(0,s.jsx)(n.code,{children:"tools"}),"\u76ee\u5f55\u4e2d,\u7136\u540e\u5728",(0,s.jsx)(n.code,{children:"build.gradle"}),"\u4e2d\u914d\u7f6e"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'def FreeMarcos = "FREE_VERSION"\nant.properties[\'wtk.home\'] = "tools"\nant.taskdef( name: "wtkpreprocess", classname: "de.pleumann.antenna.WtkPreprocess", classpath:"../tools/antenna-bin-1.0.2.jar")\ntask PreprocessFree {\n  inputs.dir "src"\n  outputs.dir "src"\n  doLast {\n      ant.wtkpreprocess(\n          srcdir: "src",\n          destdir: "src", \n          verbose:true,\n          printsymbols:true,\n          debuglevel:"debug",\n          encoding:"UTF-8",\n          symbols:FreeMarcos\n      )\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e5f\u53ef\u4ee5\u7528ant\u7684\u65b9\u5f0f\u6765\u914d\u7f6e,\u53ef\u4ee5\u770b",(0,s.jsx)(n.a,{href:"http://dannyhe.wang/2016/01/31/use-ant-in-gradle",children:"\u8fd9\u7bc7\u6587\u7ae0"})]}),"\n",(0,s.jsx)(n.h4,{id:"\u4f7f\u7528",children:"\u4f7f\u7528"}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u5728java\u4ee3\u7801\u91cc\u8fd9\u6837\u4f7f\u7528:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public void buy(){\n//#ifdef FREE_VERSION\n      pay(0);\n//#else \n      pay(100.0);\n//#endif\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6267\u884cgradle task:",(0,s.jsx)(n.code,{children:"gradle PreprocessFree"}),",\u7136\u540e\u91cd\u65b0\u6253\u5f00\u4e0a\u9762\u7684\u4ee3\u7801\u6587\u4ef6,\u5c31\u80fd\u770b\u89c1\u6e90\u7801\u7684\u53d8\u5316\u4e86:)"]}),"\n",(0,s.jsx)(n.h4,{id:"\u6700\u540e",children:"\u6700\u540e"}),"\n",(0,s.jsxs)(n.p,{children:["\u5c06\u4e0a\u9762\u7684",(0,s.jsx)(n.code,{children:"PreprocessFree"}),"\u4efb\u52a1\u52a0\u5230\u5bf9\u5e94\u7684",(0,s.jsx)(n.code,{children:"Productflavor"}),"\u7f16\u8bd1\u4e2d,\u8fd9\u6837\u5728\u6211\u4eec\u6bcf\u6b21\u6267\u884c",(0,s.jsx)(n.code,{children:"assemble"}),"\u4efb\u52a1\u7684\u65f6\u5019,\u4fbf\u4f1a\u81ea\u52a8\u6267\u884c\u4ee3\u7801\u7684\u751f\u6210\u4efb\u52a1\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6bd4\u5982\u6211\u5b9a\u4e49\u7684flavor\u4e3a",(0,s.jsx)(n.code,{children:"free"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"android.applicationVariants.all { variant ->\n  variant.productFlavors.each { flavor ->\n      if (flavor.name.equals('free')) {\n          variant.javaCompile.dependsOn(PreprocessFree)\n      }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a",(0,s.jsx)(n.code,{children:"flavor"}),"\u548c\u591a\u4e2aPreprocess\u4efb\u52a1,\u4e0d\u540c\u7684",(0,s.jsx)(n.code,{children:"flavor"}),"\u4f7f\u7528\u4e0d\u540c\u7684java\u6e90\u7801,\u8fd9\u5c31\u5b9e\u73b0\u4e86\u591a\u4e2a\u7248\u672c\u7684\u9700\u6c42\uff0c\u800c\u4e14\u4e5f\u4e0d\u9700\u8981\u5c06\u6e90\u7801\u5206\u76ee\u5f55\u653e\u4e86\u3002\nhappy coding :)"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>l});var a=r(6540);const s={},i=a.createContext(s);function d(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);